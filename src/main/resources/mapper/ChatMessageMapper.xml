<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.web.userchat.mapper.ChatMessageMapper">

    <resultMap id="chatMessageMap" type="ChatMessage">
        <id property="messageId" column="message_id"/>
        <result property="roomId" column="room_id"/>
        <result property="sender" column="sender"/>
        <result property="message" column="message"/>
        <result property="type" column="type"/>
        <result property="sendTime" column="send_time"/>
    </resultMap>

    <!-- 메세지 입력 시 저장 -->
    <insert id="save" parameterType="ChatMessage" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO chat_messages (
                room_id,
                sender,
                message,
                type,
                send_time
        ) VALUES (
                #{roomId},
                #{sender},
                #{message},
                #{type},
                #{sendTime}
        )
    </insert>

    <!-- 채팅방 고유아이디로 메세지 조회 -->
    <select id="findByRoomId" resultMap="chatMessageMap">
        SELECT
            message_id,
            room_id,
            sender,
            message,
            type,
            send_time
        FROM chat_messages
        WHERE room_id = #{roomId}
        ORDER BY send_time ASC
    </select>

    <!-- 채팅방 아이디에 포함된 메세지를 삭제 -->
    <delete id="deleteByRoomId">
        DELETE FROM chat_messages
        WHERE room_id = #{roomId}
    </delete>

    <!-- 특정 사용자가 보낸 메세지 삭제 -->
    <delete id="deleteByUser">
        DELETE FROM chat_messages
        WHERE sender = #{sender}
    </delete>

</mapper>